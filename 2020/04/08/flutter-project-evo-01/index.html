<!DOCTYPE html><html lang="en" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=5"><title>Flutter项目实践 - Evo音乐播放器（1） | 与水的故事</title><meta name="description" content="Flutter项目实践 - Evo音乐播放器（1）"><meta name="keywords" content="flutter,evo"><meta name="author" content="若鱼"><meta name="copyright" content="若鱼"><meta name="format-detection" content="telephone=no"><link rel="shortcut icon" href="/img/favicon.ico"><link rel="preconnect" href="//cdn.jsdelivr.net"><link rel="preconnect" href="http://ta.qq.com"><link rel="preconnect" href="https://fonts.googleapis.com" crossorigin><link rel="preconnect" href="//busuanzi.ibruce.info"><meta name="twitter:card" content="summary"><meta name="twitter:title" content="Flutter项目实践 - Evo音乐播放器（1）"><meta name="twitter:description" content="Flutter项目实践 - Evo音乐播放器（1）"><meta name="twitter:image" content="https://tva1.sinaimg.cn/large/00831rSTgy1gdlout454uj30v90istak.jpg"><meta property="og:type" content="article"><meta property="og:title" content="Flutter项目实践 - Evo音乐播放器（1）"><meta property="og:url" content="http://songjiaqiang.com/2020/04/08/flutter-project-evo-01/"><meta property="og:site_name" content="与水的故事"><meta property="og:description" content="Flutter项目实践 - Evo音乐播放器（1）"><meta property="og:image" content="https://tva1.sinaimg.cn/large/00831rSTgy1gdlout454uj30v90istak.jpg"><meta http-equiv="Cache-Control" content="no-transform"><meta http-equiv="Cache-Control" content="no-siteapp"><script src="https://cdn.jsdelivr.net/npm/js-cookie/dist/js.cookie.min.js"></script><script>const autoChangeMode = 'false'
var t = Cookies.get("theme");
if (autoChangeMode == '1'){
const isDarkMode = window.matchMedia("(prefers-color-scheme: dark)").matches
const isLightMode = window.matchMedia("(prefers-color-scheme: light)").matches
const isNotSpecified = window.matchMedia("(prefers-color-scheme: no-preference)").matches
const hasNoSupport = !isDarkMode && !isLightMode && !isNotSpecified

if (t === undefined){
  if (isLightMode) activateLightMode()
  else if (isDarkMode) activateDarkMode()
  else if (isNotSpecified || hasNoSupport){
    console.log('You specified no preference for a color scheme or your browser does not support it. I Schedule dark mode during night time.')
    now = new Date();
    hour = now.getHours();
    isNight = hour < 6 || hour >= 18
    isNight ? activateDarkMode() : activateLightMode()
}
} else if (t == 'light') activateLightMode()
else activateDarkMode()


} else if (autoChangeMode == '2'){
  now = new Date();
  hour = now.getHours();
  isNight = hour < 6 || hour >= 18
  if(t === undefined) isNight? activateDarkMode() : activateLightMode()
  else if (t === 'light') activateLightMode()
  else activateDarkMode() 
} else {
  if ( t == 'dark' ) activateDarkMode()
  else if ( t == 'light') activateLightMode()
}

function activateDarkMode(){
  document.documentElement.setAttribute('data-theme', 'dark')
  if (document.querySelector('meta[name="theme-color"]') !== null){
    document.querySelector('meta[name="theme-color"]').setAttribute('content','#000')
  }
}
function activateLightMode(){
  document.documentElement.setAttribute('data-theme', 'light')
  if (document.querySelector('meta[name="theme-color"]') !== null){
  document.querySelector('meta[name="theme-color"]').setAttribute('content','#fff')
  }
}</script><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/font-awesome@latest/css/font-awesome.min.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.css"><link rel="canonical" href="http://songjiaqiang.com/2020/04/08/flutter-project-evo-01/"><link rel="next" title="Flutter学习笔记3 - 基础控件" href="http://songjiaqiang.com/2020/02/05/007-learning-flutter-3-base-widget/"><link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/gitalk/dist/gitalk.min.css"><script src="https://cdn.jsdelivr.net/npm/gitalk@latest/dist/gitalk.min.js"></script><script src="https://cdn.jsdelivr.net/npm/blueimp-md5@2.10.0/js/md5.min.js"></script><script src="http://tajs.qq.com/stats?sId=66514295" charset="UTF-8"></script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Titillium+Web"><script>var GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: undefined,
  translate: {"defaultEncoding":2,"translateDelay":0,"cookieDomain":"https://xxx/","msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"简"},
  copy: {
    success: 'Copy successfully',
    error: 'Copy error',
    noSupport: 'The browser does not support'
  },
  bookmark: {
    title: 'Snackbar.bookmark.title',
    message_prev: 'Press',
    message_next: 'to bookmark this page'
  },
  runtime_unit: 'days',
  runtime: true,
  copyright: undefined,
  ClickShowText: undefined,
  medium_zoom: false,
  fancybox: true,
  Snackbar: undefined,
  baiduPush: false,
  isHome: false,
  isPost: true
  
}</script><meta name="generator" content="Hexo 4.2.0"><link rel="stylesheet" href="/css/prism-tomorrow.css" type="text/css"></head><body><header> <div id="page-header"><span class="pull_left" id="blog_name"><a class="blog_title" id="site-name" href="/">与水的故事</a></span><span class="toggle-menu pull_right close"><a class="site-page"><i class="fa fa-bars fa-fw" aria-hidden="true"></i></a></span><span class="pull_right menus"><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 金</span></a></div><div class="menus_item"><a class="site-page" href="/code/"><i class="fa-fw fa fa-code"></i><span> 木</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fa fa-globe"></i><span> 水</span></a></div><div class="menus_item"><a class="site-page" href="/apps/"><i class="fa-fw fa fa-cubes"></i><span> 火</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 土</span></a></div></div></span></div></header><div id="mobile-sidebar"><div id="menu_mask"></div><div id="mobile-sidebar-menus"><div class="mobile_author_icon"><img class="avatar-img" src="https://avatars1.githubusercontent.com/u/5006599?s=460&amp;v=4" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"></div><div class="mobile_post_data"><div class="mobile_data_item is-center"><div class="mobile_data_link"><a href="/archives/"><div class="headline">Articles</div><div class="length_num">8</div></a></div></div><div class="mobile_data_item is-center">      <div class="mobile_data_link"><a href="/tags/"><div class="headline">Tags</div><div class="length_num">8</div></a></div></div></div><hr><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fa fa-home"></i><span> 金</span></a></div><div class="menus_item"><a class="site-page" href="/code/"><i class="fa-fw fa fa-code"></i><span> 木</span></a></div><div class="menus_item"><a class="site-page" href="/gallery/"><i class="fa-fw fa fa-globe"></i><span> 水</span></a></div><div class="menus_item"><a class="site-page" href="/apps/"><i class="fa-fw fa fa-cubes"></i><span> 火</span></a></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fa fa-heart"></i><span> 土</span></a></div></div></div><div id="mobile-sidebar-toc"><div class="toc_mobile_headline">Catalog</div><div class="sidebar-toc__content"><ol class="toc_mobile_items"><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#项目背景"><span class="toc_mobile_items-number">1.</span> <span class="toc_mobile_items-text">项目背景</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#创建项目"><span class="toc_mobile_items-number">2.</span> <span class="toc_mobile_items-text">创建项目</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Create-repo"><span class="toc_mobile_items-number">2.1.</span> <span class="toc_mobile_items-text">Create repo</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#New-project"><span class="toc_mobile_items-number">2.2.</span> <span class="toc_mobile_items-text">New project</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#左右滑屏"><span class="toc_mobile_items-number">3.</span> <span class="toc_mobile_items-text">左右滑屏</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#TabController"><span class="toc_mobile_items-number">3.1.</span> <span class="toc_mobile_items-text">TabController</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#代码解释"><span class="toc_mobile_items-number">3.1.1.</span> <span class="toc_mobile_items-text">代码解释</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#TabBar"><span class="toc_mobile_items-number">3.2.</span> <span class="toc_mobile_items-text">TabBar</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#代码解释-1"><span class="toc_mobile_items-number">3.2.1.</span> <span class="toc_mobile_items-text">代码解释</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#代码解释-2"><span class="toc_mobile_items-number">3.2.2.</span> <span class="toc_mobile_items-text">代码解释</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#代码解释-3"><span class="toc_mobile_items-number">3.2.3.</span> <span class="toc_mobile_items-text">代码解释</span></a></li></ol></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-2"><a class="toc_mobile_items-link" href="#推荐页"><span class="toc_mobile_items-number">4.</span> <span class="toc_mobile_items-text">推荐页</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#列表"><span class="toc_mobile_items-number">4.1.</span> <span class="toc_mobile_items-text">列表</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#代码解释-4"><span class="toc_mobile_items-number">4.1.1.</span> <span class="toc_mobile_items-text">代码解释</span></a></li><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#代码解释-5"><span class="toc_mobile_items-number">4.1.2.</span> <span class="toc_mobile_items-text">代码解释</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#加载数据"><span class="toc_mobile_items-number">4.2.</span> <span class="toc_mobile_items-text">加载数据</span></a><ol class="toc_mobile_items-child"><li class="toc_mobile_items-item toc_mobile_items-level-4"><a class="toc_mobile_items-link" href="#代码解释-6"><span class="toc_mobile_items-number">4.2.1.</span> <span class="toc_mobile_items-text">代码解释</span></a></li></ol></li><li class="toc_mobile_items-item toc_mobile_items-level-3"><a class="toc_mobile_items-link" href="#Json序列化-反序列化"><span class="toc_mobile_items-number">4.3.</span> <span class="toc_mobile_items-text">Json序列化&#x2F;反序列化</span></a></li></ol></li></ol></div></div></div><div id="body-wrap"><i class="fa fa-arrow-right" id="toggle-sidebar" aria-hidden="true">     </i><div class="auto_open" id="sidebar"><div class="sidebar-toc"><div class="sidebar-toc__title">Catalog</div><div class="sidebar-toc__progress"><span class="progress-notice">You've read</span><span class="progress-num">0</span><span class="progress-percentage">%</span><div class="sidebar-toc__progress-bar">     </div></div><div class="sidebar-toc__content"><ol class="toc"><li class="toc-item toc-level-2"><a class="toc-link" href="#项目背景"><span class="toc-number">1.</span> <span class="toc-text">项目背景</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#创建项目"><span class="toc-number">2.</span> <span class="toc-text">创建项目</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#Create-repo"><span class="toc-number">2.1.</span> <span class="toc-text">Create repo</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#New-project"><span class="toc-number">2.2.</span> <span class="toc-text">New project</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#左右滑屏"><span class="toc-number">3.</span> <span class="toc-text">左右滑屏</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#TabController"><span class="toc-number">3.1.</span> <span class="toc-text">TabController</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#代码解释"><span class="toc-number">3.1.1.</span> <span class="toc-text">代码解释</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#TabBar"><span class="toc-number">3.2.</span> <span class="toc-text">TabBar</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#代码解释-1"><span class="toc-number">3.2.1.</span> <span class="toc-text">代码解释</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#代码解释-2"><span class="toc-number">3.2.2.</span> <span class="toc-text">代码解释</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#代码解释-3"><span class="toc-number">3.2.3.</span> <span class="toc-text">代码解释</span></a></li></ol></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#推荐页"><span class="toc-number">4.</span> <span class="toc-text">推荐页</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#列表"><span class="toc-number">4.1.</span> <span class="toc-text">列表</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#代码解释-4"><span class="toc-number">4.1.1.</span> <span class="toc-text">代码解释</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#代码解释-5"><span class="toc-number">4.1.2.</span> <span class="toc-text">代码解释</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#加载数据"><span class="toc-number">4.2.</span> <span class="toc-text">加载数据</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#代码解释-6"><span class="toc-number">4.2.1.</span> <span class="toc-text">代码解释</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#Json序列化-反序列化"><span class="toc-number">4.3.</span> <span class="toc-text">Json序列化&#x2F;反序列化</span></a></li></ol></li></ol></div></div></div><main id="content-outer"><div id="top-container" style="background-image: url(https://tva1.sinaimg.cn/large/00831rSTgy1gdlout454uj30v90istak.jpg)"><div id="post-info"><div id="post-title"><div class="posttitle">Flutter项目实践 - Evo音乐播放器（1）</div></div><div id="post-meta"><time class="post-meta__date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> Created 2020-04-08<span class="post-meta__separator">|</span><i class="fa fa-history fa-fw" aria-hidden="true"></i> Updated 2020-04-08</time><div class="post-meta-wordcount"><div class="post-meta-pv-cv"><span><i class="fa fa-eye post-meta__icon fa-fw" aria-hidden="true"> </i>Post View:</span><span id="busuanzi_value_page_pv"></span><span class="post-meta__separator">|</span><i class="fa fa-comments-o post-meta__icon fa-fw" aria-hidden="true"></i><span>comments:</span><a href="/2020/04/08/flutter-project-evo-01/#post-comment"><span class="gitalk-comment-count comment-count"></span></a></div></div></div></div></div><div class="layout layout_post" id="content-inner">   <article id="post"><div class="article-container" id="post-content"><h2 id="项目背景"><a href="#项目背景" class="headerlink" title="项目背景"></a>项目背景</h2><p>2020年1月份换了新工作，由于工作需要，开始了<a href="https://flutter.dev/" target="_blank" rel="noopener">Flutter</a>的学习之旅，另一方面，自己也认为Flutter是未来移动项目界面开发的一大利器，具体优点这里就不赘述了，总之是很值得移动和web端开发的同行们学习的。</p>
<p>年后的紧张工作也告一段落了，利用清明几天假期，做一个Demo程序来检验一下学习成果，当然，以后还会持续更新，将flutter的一些实用的特性用在这个项目中。</p>
<p>为什么选择重写<a href="https://github.com/SongJiaqiang/EvoRadio" target="_blank" rel="noopener">EvoRadio</a>，EvoRadio是我2016年刚开始学习Swift时的实践项目，到现在已经年久失修，而且我对环境音乐也比较感兴趣，几乎每天都在用，在github上也得到了60多位朋友的star支持。但是问题也是很多的，比如没有适配iPhone X系列的刘海屏，播放控制不灵敏，听歌操作太复杂等等。所以，选择重写EvoRadio就是要简化音乐播放的流程，优化播放质量，让它成为一个“不仅仅是个Flutter Demo”的app，简化而不简单。</p>
<p>我给它重新命名为<code>Evo</code>，UI参考豆瓣FM，我会一步步记录下自己的开发步骤，读者也可以根据步骤来完成项目。</p>
<p>Let’s Go！</p>
<h2 id="创建项目"><a href="#创建项目" class="headerlink" title="创建项目"></a>创建项目</h2><h3 id="Create-repo"><a href="#Create-repo" class="headerlink" title="Create repo"></a>Create repo</h3><p>首先在我自己的github下创建了一个Evo项目，地址是：<a href="https://github.com/SongJiaqiang/Evo，然后克隆到本地。" target="_blank" rel="noopener">https://github.com/SongJiaqiang/Evo，然后克隆到本地。</a></p>
<h3 id="New-project"><a href="#New-project" class="headerlink" title="New project"></a>New project</h3><p>我使用的IDE是Miscrosoft Visual Code，简称VSCode，使用快捷键Shift+Command+P，输入<code>flutter</code>，选择New Project，然后输入项目名称<code>evo</code>，就可以得到一个hello world项目了。</p>
<p>注：开发环境安装请参照官方教程：<a href="https://flutter.dev/docs/get-started/install/macos" target="_blank" rel="noopener">https://flutter.dev/docs/get-started/install/macos</a></p>
<a href="http://q8ffj20b0.bkt.clouddn.com/blog/2020-04-07-163609.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption="CEDF8F03-A93C-4BA9-B98E-67EC79A16F8B" class="fancybox"><img alt="CEDF8F03-A93C-4BA9-B98E-67EC79A16F8B" style="zoom:50%;" title="CEDF8F03-A93C-4BA9-B98E-67EC79A16F8B" data-src="http://q8ffj20b0.bkt.clouddn.com/blog/2020-04-07-163609.jpg" class="lazyload"></a>

<p>关闭VSCode，将evo项目文件拷贝到git目录。</p>
<p>打开Terminal客户端，我使用的是iTerm，进入evo根目录，使用<code>flutter run</code>运行app，也可以直接在VSCode上运行。如果你的电脑打开了多个设备，包括手机、模拟器，可能会让你选择设备id。如果你的设备上安装有多个flutter项目，还会提示你选择appid，具体命令如下，根据自己的实际情况配置即可。</p>
<p><code>flutter run -d &lt;deviceID&gt; --app-id &lt;appID&gt;</code></p>
<p>因为我偏爱使用真机调试，我的真机设备是iPhone，所以这里还会遇到一个签名的问题，命令行会提示你选择电脑上已安装的证书，也可以直接打开iOS宿主项目进行配置，目录是<code>ios/Runner.xcworkspace</code>。配置签名同时，也顺手修改了一下appid。</p>
<p>由于我用的Xcode版本是11.4，所以还会出现一个Framework链接的问题，解决方案flutter官方已经给出：<a href="https://flutter.dev/docs/development/ios-project-migration" target="_blank" rel="noopener">https://flutter.dev/docs/development/ios-project-migration</a></p>
<p><code>Building for iOS, but the linked and embedded framework &#39;App.framework&#39; was built for iOS Simulator.</code></p>
<p>至此，就得到了一个可持续开发的初始项目了。</p>
<p>git commit记录一下：</p>
<pre class=" language-shell"><code class="language-shell">git commit -m 'New project'</code></pre>
<p>慢着！我们应该忽略掉一些不需要提交的文件，这里直接使用flutter项目的<a href="https://github.com/flutter/flutter/blob/master/.gitignore" target="_blank" rel="noopener">gitignore</a>文件，文件拷贝到evo根目录下，使用git amend重新提交一下commit。</p>
<a href="http://q8ffj20b0.bkt.clouddn.com/blog/2020-04-07-163511.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption="image-20200403113930571" class="fancybox"><img alt="image-20200403113930571" style="zoom: 25%;" title="image-20200403113930571" data-src="http://q8ffj20b0.bkt.clouddn.com/blog/2020-04-07-163511.jpg" class="lazyload"></a>

<h2 id="左右滑屏"><a href="#左右滑屏" class="headerlink" title="左右滑屏"></a>左右滑屏</h2><h3 id="TabController"><a href="#TabController" class="headerlink" title="TabController"></a>TabController</h3><p>根据豆瓣FM的设计，主页是有两屏可以左右滑动的，如图</p>
<a href="http://q8ffj20b0.bkt.clouddn.com/blog/2020-04-07-163624.gif" target="_blank" rel="noopener" data-fancybox="group" data-caption="demo_video_01" class="fancybox"><img alt="demo_video_01" style="zoom:25%;" title="demo_video_01" data-src="http://q8ffj20b0.bkt.clouddn.com/blog/2020-04-07-163624.gif" class="lazyload"></a>

<p>根据这个滑动效果，我们可以使用<code>TabController</code>，也可以自定义<code>ScrollView</code>，简单起见我们采用<code>TabController</code>来实现，具体代码如下，请使用下面代码替换你的<code>_MyHomePageState</code>类。</p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">class</span> <span class="token class-name">_MyHomePageState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>MyHomePage<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">DefaultTabController</span><span class="token punctuation">(</span>
      length<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      child<span class="token punctuation">:</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
        appBar<span class="token punctuation">:</span> <span class="token function">AppBar</span><span class="token punctuation">(</span>title<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Evo'</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        body<span class="token punctuation">:</span> <span class="token function">TabBarView</span><span class="token punctuation">(</span>
          children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token function">Container</span><span class="token punctuation">(</span>
              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>redAccent<span class="token punctuation">,</span>
              child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>
                child<span class="token punctuation">:</span>
                    <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'First Page'</span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">Container</span><span class="token punctuation">(</span>
              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>greenAccent<span class="token punctuation">,</span>
              child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>
                child<span class="token punctuation">:</span>
                    <span class="token function">Text</span><span class="token punctuation">(</span><span class="token string">'Second Page'</span><span class="token punctuation">,</span> style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="代码解释"><a href="#代码解释" class="headerlink" title="代码解释"></a>代码解释</h4><ol>
<li>TabController是Flutter自带的tab控制器，可以用于多屏滚动效果。</li>
<li>参考<a href="https://medium.com/@mohamedelamin/flutter-tabs-example-5dca1f06329e" target="_blank" rel="noopener">资料</a></li>
</ol>
<a href="http://q8ffj20b0.bkt.clouddn.com/blog/2020-04-07-163659.gif" target="_blank" rel="noopener" data-fancybox="group" data-caption="demo_video_02" class="fancybox"><img alt="demo_video_02" style="zoom:25%;" title="demo_video_02" data-src="http://q8ffj20b0.bkt.clouddn.com/blog/2020-04-07-163659.gif" class="lazyload"></a>



<h3 id="TabBar"><a href="#TabBar" class="headerlink" title="TabBar"></a>TabBar</h3><p>TableController有自带的Tabbar，但是不符合我们想要的效果，所以我们自定义一个TabBar吧。</p>
<p>我们在lib目录下创建一个新文件名<code>top_bar.dart</code>，这里存放自定义的TabBar，叫做<code>TopBar</code>，代码如下。</p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">TopBar</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token keyword">implements</span> <span class="token class-name">PreferredSizeWidget</span> <span class="token punctuation">{</span>
  <span class="token metadata symbol">@override</span>
  Size <span class="token keyword">get</span> preferredSize <span class="token operator">=</span><span class="token operator">></span> <span class="token function">Size</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">60</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Container</span><span class="token punctuation">(</span>
      color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>
      child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
        crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>end<span class="token punctuation">,</span>
        mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>end<span class="token punctuation">,</span>
        mainAxisSize<span class="token punctuation">:</span> MainAxisSize<span class="token punctuation">.</span>max<span class="token punctuation">,</span>
        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">></span><span class="token punctuation">[</span>
          <span class="token function">Container</span><span class="token punctuation">(</span>
            height<span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>
              mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceBetween<span class="token punctuation">,</span>
              children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">></span><span class="token punctuation">[</span>
                <span class="token function">Container</span><span class="token punctuation">(</span>
                  padding<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                    <span class="token string">'EvoRadio'</span><span class="token punctuation">,</span>
                    style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
                      color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">,</span>
                      fontSize<span class="token punctuation">:</span> <span class="token number">22</span><span class="token punctuation">,</span>
                      fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">Container</span><span class="token punctuation">(</span>
                  child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>
                    children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">></span><span class="token punctuation">[</span>
                      <span class="token function">IconButton</span><span class="token punctuation">(</span>
                        iconSize<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
                        icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>search<span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token function">IconButton</span><span class="token punctuation">(</span>
                        iconSize<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
                        icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>person_outline<span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">Container</span><span class="token punctuation">(</span>
            padding<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            height<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>
              children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">></span><span class="token punctuation">[</span>
                <span class="token function">Container</span><span class="token punctuation">(</span>
                  height<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
                  width<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
                  decoration<span class="token punctuation">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>
                    color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>greenAccent<span class="token punctuation">,</span>
                    borderRadius<span class="token punctuation">:</span> BorderRadius<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
                      Radius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">SizedBox</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">Container</span><span class="token punctuation">(</span>
                  height<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
                  width<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span>
                  decoration<span class="token punctuation">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>
                    color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>greenAccent<span class="token punctuation">,</span>
                    borderRadius<span class="token punctuation">:</span> BorderRadius<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>
                      Radius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">SizedBox</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>接着我们使用<code>TopBar</code>替换掉main.dart中的<code>AppBar</code></p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">class</span> <span class="token class-name">_MyHomePageState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>MyHomePage<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">DefaultTabController</span><span class="token punctuation">(</span>
      length<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      child<span class="token punctuation">:</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
        appBar<span class="token punctuation">:</span> <span class="token function">TopBar</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        body<span class="token punctuation">:</span> <span class="token function">TabBarView</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token comment" spellcheck="true">//已省略部分代码</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="代码解释-1"><a href="#代码解释-1" class="headerlink" title="代码解释"></a>代码解释</h4><ol>
<li>查看AppBar源码，我们发现它实现了<code>PreferredSizeWidget</code>，这个Widget是有一个必须实现的<code>preferredSize</code>属性，<code>preferredSize</code>决定了TopBar的高度，我们暂且设为60。参考<a href="https://api.flutter.dev/flutter/widgets/PreferredSizeWidget-class.html" target="_blank" rel="noopener">资料1</a>、<a href="https://medium.com/@ketanchoyal/create-a-custom-app-bar-flutter-e32164e0be6f" target="_blank" rel="noopener">资料2</a></li>
<li>TopBar的布局包括一个标题，两个按钮，以及一组圆点指示器</li>
</ol>
<a href="http://q8ffj20b0.bkt.clouddn.com/blog/2020-04-07-163708.png" target="_blank" rel="noopener" data-fancybox="group" data-caption="image-20200403142453818" class="fancybox"><img alt="image-20200403142453818" style="zoom:25%;" title="image-20200403142453818" data-src="http://q8ffj20b0.bkt.clouddn.com/blog/2020-04-07-163708.png" class="lazyload"></a>

<p>接下来我们为<code>TopBar</code>添加属性，允许使用者设置左侧title和右侧功能按钮，代码如下：</p>
<p>top_bar.dart</p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">class</span> <span class="token class-name">TopBar</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token keyword">implements</span> <span class="token class-name">PreferredSizeWidget</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// 标题</span>
  <span class="token keyword">final</span> String title<span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// 右侧功能按钮组合</span>
  <span class="token keyword">final</span> List<span class="token operator">&lt;</span>Widget<span class="token operator">></span> children<span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// 标题点击事件</span>
  <span class="token keyword">final</span> Function onTitleTapped<span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">final</span> Size preferredSize<span class="token punctuation">;</span>

  <span class="token function">TopBar</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token metadata symbol">@required</span> <span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// title为必须属性</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>onTitleTapped<span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> preferredSize <span class="token operator">=</span> Size<span class="token punctuation">.</span><span class="token function">fromHeight</span><span class="token punctuation">(</span><span class="token number">60.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Container</span><span class="token punctuation">(</span>
      color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>
      child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
        crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>end<span class="token punctuation">,</span>
        mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>end<span class="token punctuation">,</span>
        mainAxisSize<span class="token punctuation">:</span> MainAxisSize<span class="token punctuation">.</span>max<span class="token punctuation">,</span>
        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">></span><span class="token punctuation">[</span>
          <span class="token function">Container</span><span class="token punctuation">(</span>
            height<span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>
              mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceBetween<span class="token punctuation">,</span>
              children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">></span><span class="token punctuation">[</span>
                <span class="token function">Container</span><span class="token punctuation">(</span>
                  padding<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                    title<span class="token punctuation">,</span>    <span class="token comment" spellcheck="true">// 使用外部传入的title</span>
                    style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
                      color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">,</span>
                      fontSize<span class="token punctuation">:</span> <span class="token number">22</span><span class="token punctuation">,</span>
                      fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">Container</span><span class="token punctuation">(</span>
                  child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>
                    children<span class="token punctuation">:</span> children <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> children <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 使用外部传入的children</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token comment" spellcheck="true">// 已省略部分代码</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre>
<p>main.dart</p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">class</span> <span class="token class-name">_MyHomePageState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>MyHomePage<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">DefaultTabController</span><span class="token punctuation">(</span>
      length<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      child<span class="token punctuation">:</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
        appBar<span class="token punctuation">:</span> <span class="token function">TopBar</span><span class="token punctuation">(</span>
          title<span class="token punctuation">:</span> <span class="token string">'EvoRadio'</span><span class="token punctuation">,</span>
          onTitleTapped<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'Tap title'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">></span><span class="token punctuation">[</span>
            <span class="token function">IconButton</span><span class="token punctuation">(</span>
              iconSize<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
              icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>search<span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">IconButton</span><span class="token punctuation">(</span>
              iconSize<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
              icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>person_outline<span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token comment" spellcheck="true">// 已省略部分代码</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="代码解释-2"><a href="#代码解释-2" class="headerlink" title="代码解释"></a>代码解释</h4><ol>
<li>为TopBar添加title属性，用于设置TopBar的标题</li>
<li>为TopBar添加children属性，用于设置TopBar右侧功能按钮</li>
<li>为TopBar添加onTitleTapped属性，用于设置点击标题的回调事件</li>
</ol>
<p>再接下来，我们将<code>TopBar</code>的位置指示器和标题跟<code>TabBarView</code>的切换关联起来，代码如下：</p>
<p>top_bar.dart</p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">TopBar</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token keyword">implements</span> <span class="token class-name">PreferredSizeWidget</span> <span class="token punctuation">{</span>
  <span class="token comment" spellcheck="true">// 标题</span>
  <span class="token keyword">final</span> String title<span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// 右侧功能按钮组合</span>
  <span class="token keyword">final</span> List<span class="token operator">&lt;</span>Widget<span class="token operator">></span> children<span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// 标题点击事件</span>
  <span class="token keyword">final</span> Function onTitleTapped<span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// 指示器长度</span>
  <span class="token keyword">final</span> int indicatorLength<span class="token punctuation">;</span>
  <span class="token comment" spellcheck="true">// 指示器下标</span>
  <span class="token keyword">final</span> int indicatorIndex<span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">final</span> Size preferredSize<span class="token punctuation">;</span>

  <span class="token function">TopBar</span><span class="token punctuation">(</span><span class="token punctuation">{</span>
    <span class="token metadata symbol">@required</span> <span class="token keyword">this</span><span class="token punctuation">.</span>title<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// title为必须属性</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>children<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>onTitleTapped<span class="token punctuation">,</span>
    <span class="token metadata symbol">@required</span> <span class="token keyword">this</span><span class="token punctuation">.</span>indicatorLength<span class="token punctuation">,</span>
    <span class="token keyword">this</span><span class="token punctuation">.</span>indicatorIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token punctuation">:</span> preferredSize <span class="token operator">=</span> Size<span class="token punctuation">.</span><span class="token function">fromHeight</span><span class="token punctuation">(</span><span class="token number">60.0</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Container</span><span class="token punctuation">(</span>
      color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>
      child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
        crossAxisAlignment<span class="token punctuation">:</span> CrossAxisAlignment<span class="token punctuation">.</span>end<span class="token punctuation">,</span>
        mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>end<span class="token punctuation">,</span>
        mainAxisSize<span class="token punctuation">:</span> MainAxisSize<span class="token punctuation">.</span>max<span class="token punctuation">,</span>
        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">></span><span class="token punctuation">[</span>
          <span class="token function">Container</span><span class="token punctuation">(</span>
            height<span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>
              mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceBetween<span class="token punctuation">,</span>
              children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">></span><span class="token punctuation">[</span>
                <span class="token function">Container</span><span class="token punctuation">(</span>
                  padding<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">GestureDetector</span><span class="token punctuation">(</span>
                    onTap<span class="token punctuation">:</span> onTitleTapped<span class="token punctuation">,</span>
                    child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                      title<span class="token punctuation">,</span>
                      style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
                        color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">,</span>
                        fontSize<span class="token punctuation">:</span> <span class="token number">22</span><span class="token punctuation">,</span>
                        fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">Container</span><span class="token punctuation">(</span>
                  child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>children<span class="token punctuation">:</span> children <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">?</span> children <span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">Container</span><span class="token punctuation">(</span>
            padding<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
            height<span class="token punctuation">:</span> <span class="token number">4</span><span class="token punctuation">,</span>
            child<span class="token punctuation">:</span> <span class="token function">_buildIndicator</span><span class="token punctuation">(</span>indicatorLength<span class="token punctuation">,</span> indicatorIndex<span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token function">SizedBox</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  Widget <span class="token function">_buildIndicator</span><span class="token punctuation">(</span>int length<span class="token punctuation">,</span> int index<span class="token punctuation">,</span> double height<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    double normalWidth <span class="token operator">=</span> height<span class="token punctuation">;</span>
    double maxWidth <span class="token operator">=</span> normalWidth <span class="token operator">*</span> <span class="token number">4</span><span class="token punctuation">;</span>

    List<span class="token operator">&lt;</span>Widget<span class="token operator">></span> children <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token keyword">for</span> <span class="token punctuation">(</span><span class="token keyword">var</span> i <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      double itemWidth <span class="token operator">=</span> index <span class="token operator">==</span> i <span class="token operator">?</span> maxWidth <span class="token punctuation">:</span> normalWidth<span class="token punctuation">;</span>
      double itemHeight <span class="token operator">=</span> normalWidth<span class="token punctuation">;</span>
      double itemSpacing <span class="token operator">=</span> normalWidth<span class="token punctuation">;</span>

      <span class="token comment" spellcheck="true">// add spacing</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>i <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        children<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span><span class="token function">SizedBox</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> itemSpacing<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      <span class="token comment" spellcheck="true">// add item</span>
      <span class="token keyword">var</span> item <span class="token operator">=</span> <span class="token function">Container</span><span class="token punctuation">(</span>
        width<span class="token punctuation">:</span> itemWidth<span class="token punctuation">,</span>
        height<span class="token punctuation">:</span> itemHeight<span class="token punctuation">,</span>
        decoration<span class="token punctuation">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>
          color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>greenAccent<span class="token punctuation">,</span>
          borderRadius<span class="token punctuation">:</span> BorderRadius<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>Radius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span>itemHeight <span class="token operator">/</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">;</span>
      children<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token function">Row</span><span class="token punctuation">(</span>children<span class="token punctuation">:</span> children<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>main.dart</p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">class</span> <span class="token class-name">_MyHomePageState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>MyHomePage<span class="token operator">></span>
    <span class="token keyword">with</span> SingleTickerProviderStateMixin <span class="token punctuation">{</span>
  TabController _tabController<span class="token punctuation">;</span>
  int _currentIndex<span class="token punctuation">;</span>
  String _topBarTitle<span class="token punctuation">;</span>

  <span class="token keyword">final</span> List<span class="token operator">&lt;</span>String<span class="token operator">></span> _topBarTitles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'First Page'</span><span class="token punctuation">,</span> <span class="token string">'Second Page'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    _currentIndex <span class="token operator">=</span> <span class="token number">0</span><span class="token punctuation">;</span>
    _topBarTitle <span class="token operator">=</span> _topBarTitles<span class="token punctuation">.</span>first<span class="token punctuation">;</span>

    _tabController <span class="token operator">=</span> <span class="token function">TabController</span><span class="token punctuation">(</span>length<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> vsync<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    _tabController<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>_handleTabController<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _tabController<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">DefaultTabController</span><span class="token punctuation">(</span>
      length<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      child<span class="token punctuation">:</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
        appBar<span class="token punctuation">:</span> <span class="token function">TopBar</span><span class="token punctuation">(</span>
          title<span class="token punctuation">:</span> _topBarTitle<span class="token punctuation">,</span>
          onTitleTapped<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'Tap title'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          indicatorLength<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          indicatorIndex<span class="token punctuation">:</span> _currentIndex<span class="token punctuation">,</span>
          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">></span><span class="token punctuation">[</span>
            <span class="token function">IconButton</span><span class="token punctuation">(</span>
              iconSize<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
              icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>search<span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">IconButton</span><span class="token punctuation">(</span>
              iconSize<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
              icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>person_outline<span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        body<span class="token punctuation">:</span> <span class="token function">TabBarView</span><span class="token punctuation">(</span>
          controller<span class="token punctuation">:</span> _tabController<span class="token punctuation">,</span>
          children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token function">Container</span><span class="token punctuation">(</span>
              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>redAccent<span class="token punctuation">,</span>
              child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>
                child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                  _topBarTitles<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                  style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">Container</span><span class="token punctuation">(</span>
              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>greenAccent<span class="token punctuation">,</span>
              child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>
                child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                  _topBarTitles<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                  style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">_handleTabController</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> int index <span class="token operator">=</span> _tabController<span class="token punctuation">.</span>index<span class="token punctuation">;</span>

    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      _currentIndex <span class="token operator">=</span> index<span class="token punctuation">;</span>
      _topBarTitle <span class="token operator">=</span> _topBarTitles<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="代码解释-3"><a href="#代码解释-3" class="headerlink" title="代码解释"></a>代码解释</h4><ol>
<li>新增了<code>indicatorLength</code>表示位置指示器的长度。</li>
<li>新增了<code>indicatorIndex</code>表示位置指示器当前位置。</li>
<li>封装指示器的创建方法<code>_buildIndicator</code>，根据具体的指示器长度、位置、高度生成指示器控件。</li>
<li>为<code>_MyHomePageState</code>新增<code>_currentIndex</code>和<code>_topBarTitle</code>两个状态值，用于同步<code>TopBar</code>的标题和指示器位置。</li>
<li>为<code>TabBarView</code>设置<code>_tabController</code>，并添加监听，获取当前的page下标，同步到<code>TopBar</code>。</li>
<li><code>TopBar</code>内容切换没有使用动画，有点生硬，后续再完善。</li>
</ol>
<a href="http://q8ffj20b0.bkt.clouddn.com/blog/2020-04-07-163722.gif" target="_blank" rel="noopener" data-fancybox="group" data-caption="demo_video_03" class="fancybox"><img alt="demo_video_03" style="zoom: 25%;" title="demo_video_03" data-src="http://q8ffj20b0.bkt.clouddn.com/blog/2020-04-07-163722.gif" class="lazyload"></a>

<p>左右滑屏简单的完成了，我们先提个git记录。</p>
<pre class=" language-shell"><code class="language-shell">git commit -m 'Add TopBar as a navigation bar.'</code></pre>
<h2 id="推荐页"><a href="#推荐页" class="headerlink" title="推荐页"></a>推荐页</h2><p>推荐页是滑屏第二个页面，是一个简单的列表页，下面是豆瓣FM的效果图。</p>
<a href="http://q8ffj20b0.bkt.clouddn.com/blog/2020-04-07-163735.gif" target="_blank" rel="noopener" data-fancybox="group" data-caption="demo_video_04" class="fancybox"><img alt="demo_video_04" style="zoom:25%;" title="demo_video_04" data-src="http://q8ffj20b0.bkt.clouddn.com/blog/2020-04-07-163735.gif" class="lazyload"></a>

<h3 id="列表"><a href="#列表" class="headerlink" title="列表"></a>列表</h3><p>首先实现列表的主体框架，新建<code>tab_recommend_page.dart</code>文件，代码如下：</p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">TabRecommendPage</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token metadata symbol">@override</span>
  _TabRecommendPageState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_TabRecommendPageState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_TabRecommendPageState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>TabRecommendPage<span class="token operator">></span> <span class="token punctuation">{</span>
  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> ListView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>
        itemCount<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
        itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token function">TabRecommendPageCell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">TabRecommendPageCell</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Container</span><span class="token punctuation">(</span>
      padding<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span> right<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span> top<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span> bottom<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">></span><span class="token punctuation">[</span>
          <span class="token function">Container</span><span class="token punctuation">(</span>
            child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
              children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">></span><span class="token punctuation">[</span>
                <span class="token function">Container</span><span class="token punctuation">(</span>
                  padding<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>
                    children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">></span><span class="token punctuation">[</span>
                      <span class="token function">Expanded</span><span class="token punctuation">(</span>
                        child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                          <span class="token string">'我想和你虚度时光'</span><span class="token punctuation">,</span>
                          maxLines<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                          style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
                            color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">,</span>
                            fontSize<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
                            fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">Container</span><span class="token punctuation">(</span>
                  height<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
                  padding<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>
                    children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">></span><span class="token punctuation">[</span>
                      <span class="token function">ClipOval</span><span class="token punctuation">(</span>
                        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                          width<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
                          height<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
                          decoration<span class="token punctuation">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>
                            color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>greenAccent<span class="token punctuation">,</span>
                            borderRadius<span class="token punctuation">:</span> BorderRadius<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>Radius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                          child<span class="token punctuation">:</span> Image<span class="token punctuation">.</span><span class="token function">network</span><span class="token punctuation">(</span>
                              <span class="token string">'https://img9.doubanio.com/icon/ul129958703-1.jpg'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token function">SizedBox</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token function">RichText</span><span class="token punctuation">(</span>
                        text<span class="token punctuation">:</span> <span class="token function">TextSpan</span><span class="token punctuation">(</span>
                          style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">,</span> fontSize<span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>TextSpan<span class="token operator">></span><span class="token punctuation">[</span>
                            <span class="token function">TextSpan</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> <span class="token string">'来自'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token function">TextSpan</span><span class="token punctuation">(</span>
                              text<span class="token punctuation">:</span> <span class="token string">' Evo官方 '</span><span class="token punctuation">,</span>
                              style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token function">TextSpan</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> <span class="token string">'的推荐'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">SizedBox</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">ClipRRect</span><span class="token punctuation">(</span>
                  clipBehavior<span class="token punctuation">:</span> Clip<span class="token punctuation">.</span>antiAlias<span class="token punctuation">,</span>
                  borderRadius<span class="token punctuation">:</span> BorderRadius<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>Radius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                    height<span class="token punctuation">:</span> <span class="token number">260</span><span class="token punctuation">,</span>
                    decoration<span class="token punctuation">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>
                      color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>pinkAccent<span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
                      children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">></span><span class="token punctuation">[</span>
                        <span class="token function">Container</span><span class="token punctuation">(</span>
                          child<span class="token punctuation">:</span> Image<span class="token punctuation">.</span><span class="token function">network</span><span class="token punctuation">(</span>
                            <span class="token string">'https://p2.music.126.net/PJz3X_y5Il564dV27jHQeg==/2535473815844119.jpg'</span><span class="token punctuation">,</span>
                            height<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
                            width<span class="token punctuation">:</span> double<span class="token punctuation">.</span>infinity<span class="token punctuation">,</span>
                            fit<span class="token punctuation">:</span> BoxFit<span class="token punctuation">.</span>cover<span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token function">Row</span><span class="token punctuation">(</span>
                          mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>spaceBetween<span class="token punctuation">,</span>
                          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">></span><span class="token punctuation">[</span>
                            <span class="token function">Container</span><span class="token punctuation">(</span>
                              height<span class="token punctuation">:</span> <span class="token number">60</span><span class="token punctuation">,</span>
                              padding<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                              child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>
                                child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                                  width<span class="token punctuation">:</span> <span class="token number">36</span><span class="token punctuation">,</span>
                                  height<span class="token punctuation">:</span> <span class="token number">36</span><span class="token punctuation">,</span>
                                  decoration<span class="token punctuation">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>
                                    color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>
                                    borderRadius<span class="token punctuation">:</span>
                                        BorderRadius<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>Radius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">18</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                                  child<span class="token punctuation">:</span> <span class="token function">GestureDetector</span><span class="token punctuation">(</span>
                                    child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
                                      Icons<span class="token punctuation">.</span>headset<span class="token punctuation">,</span>
                                      color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">,</span>
                                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    onTap<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                              <span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token function">Container</span><span class="token punctuation">(</span>
                              height<span class="token punctuation">:</span> <span class="token number">60</span><span class="token punctuation">,</span>
                              padding<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>right<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                              child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>
                                children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">></span><span class="token punctuation">[</span>
                                  <span class="token function">Container</span><span class="token punctuation">(</span>
                                    width<span class="token punctuation">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
                                    height<span class="token punctuation">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
                                    decoration<span class="token punctuation">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>
                                      color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>
                                      borderRadius<span class="token punctuation">:</span>
                                          BorderRadius<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>Radius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    child<span class="token punctuation">:</span> <span class="token function">GestureDetector</span><span class="token punctuation">(</span>
                                      child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
                                        Icons<span class="token punctuation">.</span>share<span class="token punctuation">,</span>
                                        color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">,</span>
                                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                                      onTap<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                                  <span class="token function">SizedBox</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                  <span class="token function">Container</span><span class="token punctuation">(</span>
                                    width<span class="token punctuation">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
                                    height<span class="token punctuation">:</span> <span class="token number">32</span><span class="token punctuation">,</span>
                                    decoration<span class="token punctuation">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>
                                      color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>
                                      borderRadius<span class="token punctuation">:</span>
                                          BorderRadius<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>Radius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                                    child<span class="token punctuation">:</span> <span class="token function">GestureDetector</span><span class="token punctuation">(</span>
                                      child<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>
                                        Icons<span class="token punctuation">.</span>favorite_border<span class="token punctuation">,</span>
                                        color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>redAccent<span class="token punctuation">,</span>
                                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                                      onTap<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
                                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                                <span class="token punctuation">]</span><span class="token punctuation">,</span>
                              <span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">]</span><span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">]</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">]</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="代码解释-4"><a href="#代码解释-4" class="headerlink" title="代码解释"></a>代码解释</h4><ol>
<li><p>推荐页<code>TabRecommendPage</code>主要使用<code>ListView.builder</code>创建一个列表</p>
</li>
<li><p>列表项命名为<code>TabRecommendPageCell</code>，包含标题、推荐者头像、推荐者名称、推荐合集封面、试听按钮、分享按钮和收藏按钮。</p>
</li>
<li><p>FM的Cell有个三角遮罩，暂时简化掉。</p>
</li>
</ol>
<p>ListView第一个展示当前日期和星期，和其它的cell有所区别，代码如下：</p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">class</span> <span class="token class-name">TabRecommendPageHeader</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Container</span><span class="token punctuation">(</span>
      padding<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      child<span class="token punctuation">:</span> <span class="token function">ClipRRect</span><span class="token punctuation">(</span>
        clipBehavior<span class="token punctuation">:</span> Clip<span class="token punctuation">.</span>antiAlias<span class="token punctuation">,</span>
        borderRadius<span class="token punctuation">:</span> BorderRadius<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>Radius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
          <span class="token comment" spellcheck="true">// height: 130,</span>
          color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">,</span>
          child<span class="token punctuation">:</span> <span class="token function">Stack</span><span class="token punctuation">(</span>
            children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">></span><span class="token punctuation">[</span>
              <span class="token function">Positioned</span><span class="token punctuation">(</span>
                left<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                right<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                top<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                bottom<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">,</span>
                child<span class="token punctuation">:</span> Image<span class="token punctuation">.</span><span class="token function">network</span><span class="token punctuation">(</span>
                  <span class="token string">'https://hbimg.huabanimg.com/dd618f5006aaff178eaa2a1aae563fd29736a633dcd76-yBwuSb_fw658'</span><span class="token punctuation">,</span>
                  fit<span class="token punctuation">:</span> BoxFit<span class="token punctuation">.</span>cover<span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token function">Positioned</span><span class="token punctuation">(</span>
                child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                  height<span class="token punctuation">:</span> <span class="token number">130</span><span class="token punctuation">,</span>
                  padding<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">symmetric</span><span class="token punctuation">(</span>horizontal<span class="token punctuation">:</span> <span class="token number">32</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
                    mainAxisAlignment<span class="token punctuation">:</span> MainAxisAlignment<span class="token punctuation">.</span>center<span class="token punctuation">,</span>
                    children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">></span><span class="token punctuation">[</span>
                      <span class="token function">Text</span><span class="token punctuation">(</span>
                        <span class="token string">'每日私享歌单'</span><span class="token punctuation">,</span>
                        style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">,</span> fontSize<span class="token punctuation">:</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token function">Text</span><span class="token punctuation">(</span>
                        <span class="token function">dayOfWeekString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
                          color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">,</span>
                          fontSize<span class="token punctuation">:</span> <span class="token number">40</span><span class="token punctuation">,</span>
                          fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token function">Text</span><span class="token punctuation">(</span>
                        <span class="token function">dateString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                        style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">,</span> fontSize<span class="token punctuation">:</span> <span class="token number">14</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">]</span><span class="token punctuation">,</span>
          <span class="token punctuation">)</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  String <span class="token function">dateString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> DateTime now <span class="token operator">=</span> DateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> <span class="token function">DateFormat</span><span class="token punctuation">(</span><span class="token string">'yyyy.MM.dd'</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  String <span class="token function">dayOfWeekString</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> DateTime now <span class="token operator">=</span> DateTime<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">return</span> DateFormat<span class="token punctuation">.</span><span class="token function">E</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">format</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p><code>tab_recommend_page.dart</code>中的<code>_TabRecommendPageState</code>变为</p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">class</span> <span class="token class-name">_TabRecommendPageState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>TabRecommendPage<span class="token operator">></span> <span class="token punctuation">{</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">didChangeDependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">loadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">didChangeDependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> ListView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>
      itemCount<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
      itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token function">TabRecommendPageHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token function">TabRecommendPageCell</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="代码解释-5"><a href="#代码解释-5" class="headerlink" title="代码解释"></a>代码解释</h4><ol>
<li><code>TabRecommendPageHeader</code>是ListView的头部信息，展示当前日期和星期，同时配有一张底图</li>
<li>日期格式化使用了<code>Intl</code>第三方库中的<code>DateFormat</code>类，需要再文件<code>pubspec.yaml</code>中添加依赖信息<code>intl: ^0.16.1</code></li>
</ol>
<a href="http://q8ffj20b0.bkt.clouddn.com/blog/2020-04-07-163800.png" target="_blank" rel="noopener" data-fancybox="group" data-caption="undefined" class="fancybox"><img style="zoom:25%;" data-src="http://q8ffj20b0.bkt.clouddn.com/blog/2020-04-07-163800.png" class="lazyload"></a>

<p>至此，推荐页的骨架就搭好了，git记录一下</p>
<pre class=" language-shell"><code class="language-shell">git commit -m 'Add TabRecommendPage'</code></pre>
<h3 id="加载数据"><a href="#加载数据" class="headerlink" title="加载数据"></a>加载数据</h3><p>我们接下来为ListView配置上真实的数据，开始想抓取豆瓣FM的接口，但是太复杂了，也有其他开发者已经整理出豆瓣FM的接口，但是只有音乐频道数据，没有推荐列表的数据。所以我这里沿用EvoRadio整理出来的Lava推荐歌单的数据。</p>
<p>为了更好的管理文件，我们开始采用BLoC的开发模式，首先我们在lib目录下新建一个<code>recommend_page</code>目录，然后在recommend目录下分别新建ui、model、data、bloc四个文件夹，最后把<code>tab_recommend_page.dart</code>文件移到<code>lib/recommend/ui</code>目录下，同时将<code>TabRecommendPageCell</code>拆分到文件<code>tab_recommend_page_cell.dart</code>中,将<code>TabRecommendPageHeader</code>拆分到文件<code>tab_recommend_page_header.dart</code>中。</p>
<a href="http://q8ffj20b0.bkt.clouddn.com/blog/2020-04-07-163836.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption="5E10C91C-C551-49FA-9E1E-2F7B93FC8E00" class="fancybox"><img alt="5E10C91C-C551-49FA-9E1E-2F7B93FC8E00" style="zoom:25%;" title="5E10C91C-C551-49FA-9E1E-2F7B93FC8E00" data-src="http://q8ffj20b0.bkt.clouddn.com/blog/2020-04-07-163836.jpg" class="lazyload"></a>

<p>接下来我们需要新建一个模型类来封装<code>TabRecommendPageCell</code>的数据，在model目录下新建文件模型RecommendModel，文件名<code>recommend_model.dart</code>，为RecommendModel添加几个基本的属性，然后为TabRecommendPageCell新增cellModel属性和构造方法，并且使用cellModel的字段替换cell中对应信息的位置。</p>
<p>代码如下：</p>
<p>recommend_model.dart</p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">class</span> <span class="token class-name">RecommendModel</span> <span class="token punctuation">{</span>
  String id<span class="token punctuation">;</span>
  String title<span class="token punctuation">;</span>
  String avatarUrl<span class="token punctuation">;</span>
  String userName<span class="token punctuation">;</span>
  String imgUrl<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>tab_recommend_page_cell.dart</p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:evo/recommend_page/model/recommend_model.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">TabRecommendPageCell</span> <span class="token keyword">extends</span> <span class="token class-name">StatelessWidget</span> <span class="token punctuation">{</span>
  <span class="token keyword">final</span> RecommendModel cellModel<span class="token punctuation">;</span>

  <span class="token keyword">const</span> <span class="token function">TabRecommendPageCell</span><span class="token punctuation">(</span><span class="token punctuation">{</span>Key key<span class="token punctuation">,</span> <span class="token metadata symbol">@required</span> <span class="token keyword">this</span><span class="token punctuation">.</span>cellModel<span class="token punctuation">}</span><span class="token punctuation">)</span>
      <span class="token punctuation">:</span> <span class="token keyword">super</span><span class="token punctuation">(</span>key<span class="token punctuation">:</span> key<span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">Container</span><span class="token punctuation">(</span>
      padding<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span> right<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span> top<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">,</span> bottom<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
        children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">></span><span class="token punctuation">[</span>
          <span class="token function">Container</span><span class="token punctuation">(</span>
            child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
              children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">></span><span class="token punctuation">[</span>
                <span class="token function">Container</span><span class="token punctuation">(</span>
                  padding<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>
                    children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">></span><span class="token punctuation">[</span>
                      <span class="token function">Expanded</span><span class="token punctuation">(</span>
                        child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                          cellModel<span class="token punctuation">.</span>title<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 歌单名称</span>
                          maxLines<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
                          style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
                            color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">,</span>
                            fontSize<span class="token punctuation">:</span> <span class="token number">20</span><span class="token punctuation">,</span>
                            fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">Container</span><span class="token punctuation">(</span>
                  height<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
                  padding<span class="token punctuation">:</span> EdgeInsets<span class="token punctuation">.</span><span class="token function">only</span><span class="token punctuation">(</span>left<span class="token punctuation">:</span> <span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">Row</span><span class="token punctuation">(</span>
                    children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">></span><span class="token punctuation">[</span>
                      <span class="token function">ClipOval</span><span class="token punctuation">(</span>
                        child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                          width<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
                          height<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">,</span>
                          decoration<span class="token punctuation">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>
                            color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>greenAccent<span class="token punctuation">,</span>
                            borderRadius<span class="token punctuation">:</span> BorderRadius<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>Radius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">16</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                          child<span class="token punctuation">:</span> Image<span class="token punctuation">.</span><span class="token function">network</span><span class="token punctuation">(</span>cellModel<span class="token punctuation">.</span>avatarUrl<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 歌单作者图片</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token function">SizedBox</span><span class="token punctuation">(</span>width<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token function">RichText</span><span class="token punctuation">(</span>
                        text<span class="token punctuation">:</span> <span class="token function">TextSpan</span><span class="token punctuation">(</span>
                          style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">,</span> fontSize<span class="token punctuation">:</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>TextSpan<span class="token operator">></span><span class="token punctuation">[</span>
                            <span class="token function">TextSpan</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> <span class="token string">'来自'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token function">TextSpan</span><span class="token punctuation">(</span>
                              text<span class="token punctuation">:</span> <span class="token string">' ${cellModel.userName} '</span><span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 歌单作者名称</span>
                              style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token punctuation">)</span><span class="token punctuation">,</span>
                            <span class="token function">TextSpan</span><span class="token punctuation">(</span>text<span class="token punctuation">:</span> <span class="token string">'的推荐'</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                          <span class="token punctuation">]</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
                      <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    <span class="token punctuation">]</span><span class="token punctuation">,</span>
                  <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">SizedBox</span><span class="token punctuation">(</span>height<span class="token punctuation">:</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token function">ClipRRect</span><span class="token punctuation">(</span>
                  clipBehavior<span class="token punctuation">:</span> Clip<span class="token punctuation">.</span>antiAlias<span class="token punctuation">,</span>
                  borderRadius<span class="token punctuation">:</span> BorderRadius<span class="token punctuation">.</span><span class="token function">all</span><span class="token punctuation">(</span>Radius<span class="token punctuation">.</span><span class="token function">circular</span><span class="token punctuation">(</span><span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
                  child<span class="token punctuation">:</span> <span class="token function">Container</span><span class="token punctuation">(</span>
                    height<span class="token punctuation">:</span> <span class="token number">260</span><span class="token punctuation">,</span>
                    decoration<span class="token punctuation">:</span> <span class="token function">BoxDecoration</span><span class="token punctuation">(</span>
                      color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>pinkAccent<span class="token punctuation">,</span>
                    <span class="token punctuation">)</span><span class="token punctuation">,</span>
                    child<span class="token punctuation">:</span> <span class="token function">Column</span><span class="token punctuation">(</span>
                      children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">></span><span class="token punctuation">[</span>
                        <span class="token function">Container</span><span class="token punctuation">(</span>
                          child<span class="token punctuation">:</span> Image<span class="token punctuation">.</span><span class="token function">network</span><span class="token punctuation">(</span>
                            cellModel<span class="token punctuation">.</span>imgUrl<span class="token punctuation">,</span> <span class="token comment" spellcheck="true">// 歌单图片</span>
                            height<span class="token punctuation">:</span> <span class="token number">200</span><span class="token punctuation">,</span>
                            width<span class="token punctuation">:</span> double<span class="token punctuation">.</span>infinity<span class="token punctuation">,</span>
                            fit<span class="token punctuation">:</span> BoxFit<span class="token punctuation">.</span>cover<span class="token punctuation">,</span>
                          <span class="token punctuation">)</span><span class="token punctuation">,</span>
                        <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token comment" spellcheck="true">// 省略部分代码</span></code></pre>
<p>接下来我们需要一个网络库来加载网络数据，我选择<a href="https://pub.dev/packages/dio#-installing-tab-" target="_blank" rel="noopener">dio</a>，在<code>pubspec.yaml</code>文件添加dio依赖，然后运行<code>flutter pub get</code>进行安装。</p>
<pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">dependencies</span><span class="token punctuation">:</span>
  <span class="token key atrule">flutter</span><span class="token punctuation">:</span>
    <span class="token key atrule">sdk</span><span class="token punctuation">:</span> flutter
  <span class="token comment" spellcheck="true"># iOS风格图标</span>
  <span class="token key atrule">cupertino_icons</span><span class="token punctuation">:</span> ^0.1.2

  <span class="token comment" spellcheck="true"># 多语言库，时间格式化工具</span>
  <span class="token key atrule">intl</span><span class="token punctuation">:</span> ^0.16.1
  <span class="token comment" spellcheck="true"># 网络库</span>
  <span class="token key atrule">dio</span><span class="token punctuation">:</span> ^3.0.9</code></pre>
<p>有了网络库，我们就可以加载网络数据了，下面切换到<code>tab_recommend_page.dart</code>文件，</p>
<p>代码如下：</p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:flutter/material.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:evo/recommend_page/model/recommend_model.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:evo/recommend_page/ui/tab_recommend_page_cell.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:evo/recommend_page/ui/tab_recommend_page_header.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:dio/dio.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">TabRecommendPage</span> <span class="token keyword">extends</span> <span class="token class-name">StatefulWidget</span> <span class="token punctuation">{</span>
  <span class="token metadata symbol">@override</span>
  _TabRecommendPageState <span class="token function">createState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> <span class="token function">_TabRecommendPageState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">class</span> <span class="token class-name">_TabRecommendPageState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>TabRecommendPage<span class="token operator">></span> <span class="token punctuation">{</span>
  List<span class="token operator">&lt;</span>RecommendModel<span class="token operator">></span> dataSourceItems <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">didChangeDependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token function">loadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">didChangeDependencies</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> ListView<span class="token punctuation">.</span><span class="token function">builder</span><span class="token punctuation">(</span>
      itemCount<span class="token punctuation">:</span> dataSourceItems<span class="token punctuation">.</span>length <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">,</span>
      itemBuilder<span class="token punctuation">:</span> <span class="token punctuation">(</span>_<span class="token punctuation">,</span> index<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>index <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token function">TabRecommendPageHeader</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> <span class="token function">TabRecommendPageCell</span><span class="token punctuation">(</span>cellModel<span class="token punctuation">:</span> dataSourceItems<span class="token punctuation">[</span>index <span class="token operator">-</span> <span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">loadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    Dio dio <span class="token operator">=</span> <span class="token function">Dio</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Response<span class="token operator">&lt;</span>Map<span class="token operator">></span> response <span class="token operator">=</span> <span class="token keyword">await</span> dio<span class="token punctuation">.</span><span class="token keyword">get</span><span class="token punctuation">(</span>
        <span class="token string">'http://www.lavaradio.com/api/radio.listGroundPrograms.json?_pn=3&amp;_sz=20'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">.</span><span class="token function">toString</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">if</span> <span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'err'</span><span class="token punctuation">]</span> <span class="token operator">==</span> <span class="token string">'hapn.ok'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'Request success'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      Map resultData <span class="token operator">=</span> response<span class="token punctuation">.</span>data<span class="token punctuation">[</span><span class="token string">'data'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>resultData <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">print</span><span class="token punctuation">(</span>
            <span class="token string">'Request result data size:${resultData['</span>size<span class="token string">']}, total:${resultData['</span>total<span class="token string">']}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        List dataList <span class="token operator">=</span> resultData<span class="token punctuation">[</span><span class="token string">'lists'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>dataList <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> dataList<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          List<span class="token operator">&lt;</span>RecommendModel<span class="token operator">></span> newModels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span>Map item <span class="token keyword">in</span> dataList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            RecommendModel model <span class="token operator">=</span> <span class="token function">RecommendModel</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
            model<span class="token punctuation">.</span>id <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">'program_id'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            model<span class="token punctuation">.</span>title <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">'program_name'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            model<span class="token punctuation">.</span>imgUrl <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">'pic_url'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            model<span class="token punctuation">.</span>userName <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'uname'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
            model<span class="token punctuation">.</span>avatarUrl <span class="token operator">=</span> item<span class="token punctuation">[</span><span class="token string">'user'</span><span class="token punctuation">]</span><span class="token punctuation">[</span><span class="token string">'pic_url'</span><span class="token punctuation">]</span><span class="token punctuation">;</span>

            newModels<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          dataSourceItems<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dataSourceItems<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>newModels<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<h4 id="代码解释-6"><a href="#代码解释-6" class="headerlink" title="代码解释"></a>代码解释</h4><ol>
<li>使用dio加载LavaRadio的精选歌单接口</li>
<li>成功获取到数据后装载到<code>List&lt;RecommendModel&gt; dataSourceItems</code>，然后通过setState刷新页面。</li>
<li>因为ListView有个单独header cell，所有itemCount的值是dataSourceItems.length + 1。</li>
</ol>
<p>TopBar上面的<code>Second Page</code>看着不顺眼，先改掉吧，字体改成26号。</p>
<p>另外再把Second Page设置为默认显示页。</p>
<p>top_bar.dart</p>
<pre class=" language-dart"><code class="language-dart"><span class="token function">Text</span><span class="token punctuation">(</span>
  title<span class="token punctuation">,</span>
  style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>
    color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>black<span class="token punctuation">,</span>
    fontSize<span class="token punctuation">:</span> <span class="token number">26</span><span class="token punctuation">,</span>
    fontWeight<span class="token punctuation">:</span> FontWeight<span class="token punctuation">.</span>bold<span class="token punctuation">,</span>
  <span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span><span class="token punctuation">,</span></code></pre>
<p>main.dart</p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">class</span> <span class="token class-name">_MyHomePageState</span> <span class="token keyword">extends</span> <span class="token class-name">State</span><span class="token operator">&lt;</span>MyHomePage<span class="token operator">></span>
    <span class="token keyword">with</span> SingleTickerProviderStateMixin <span class="token punctuation">{</span>
  TabController _tabController<span class="token punctuation">;</span>
  int _currentIndex<span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 下标</span>
  String _topBarTitle<span class="token punctuation">;</span>

  <span class="token keyword">final</span> List<span class="token operator">&lt;</span>String<span class="token operator">></span> _topBarTitles <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token string">'私人兆赫'</span><span class="token punctuation">,</span> <span class="token string">'今天'</span><span class="token punctuation">]</span><span class="token punctuation">;</span> <span class="token comment" spellcheck="true">// 新title</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">initState</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    _currentIndex <span class="token operator">=</span> <span class="token number">1</span><span class="token punctuation">;</span>
    _topBarTitle <span class="token operator">=</span> _topBarTitles<span class="token punctuation">[</span>_currentIndex<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token comment" spellcheck="true">// 初始化TabBarView长度并设置初始位置</span>
    _tabController <span class="token operator">=</span> <span class="token function">TabController</span><span class="token punctuation">(</span>length<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span> vsync<span class="token punctuation">:</span> <span class="token keyword">this</span><span class="token punctuation">,</span> initialIndex<span class="token punctuation">:</span> _currentIndex<span class="token punctuation">)</span><span class="token punctuation">;</span>
    _tabController<span class="token punctuation">.</span><span class="token function">addListener</span><span class="token punctuation">(</span>_handleTabController<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  <span class="token keyword">void</span> <span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _tabController<span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token keyword">super</span><span class="token punctuation">.</span><span class="token function">dispose</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token metadata symbol">@override</span>
  Widget <span class="token function">build</span><span class="token punctuation">(</span>BuildContext context<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token function">DefaultTabController</span><span class="token punctuation">(</span>
      length<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
      initialIndex<span class="token punctuation">:</span> <span class="token number">1</span><span class="token punctuation">,</span>
      child<span class="token punctuation">:</span> <span class="token function">Scaffold</span><span class="token punctuation">(</span>
        appBar<span class="token punctuation">:</span> <span class="token function">TopBar</span><span class="token punctuation">(</span>
          title<span class="token punctuation">:</span> _topBarTitle<span class="token punctuation">,</span>
          onTitleTapped<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'Tap title'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">,</span>
          indicatorLength<span class="token punctuation">:</span> <span class="token number">2</span><span class="token punctuation">,</span>
          indicatorIndex<span class="token punctuation">:</span> _currentIndex<span class="token punctuation">,</span>
          children<span class="token punctuation">:</span> <span class="token operator">&lt;</span>Widget<span class="token operator">></span><span class="token punctuation">[</span>
            <span class="token function">IconButton</span><span class="token punctuation">(</span>
              iconSize<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
              icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>search<span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">IconButton</span><span class="token punctuation">(</span>
              iconSize<span class="token punctuation">:</span> <span class="token number">30</span><span class="token punctuation">,</span>
              icon<span class="token punctuation">:</span> <span class="token function">Icon</span><span class="token punctuation">(</span>Icons<span class="token punctuation">.</span>person_outline<span class="token punctuation">,</span> size<span class="token punctuation">:</span> <span class="token number">24</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
              onPressed<span class="token punctuation">:</span> <span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
        body<span class="token punctuation">:</span> <span class="token function">TabBarView</span><span class="token punctuation">(</span>
          controller<span class="token punctuation">:</span> _tabController<span class="token punctuation">,</span>
          children<span class="token punctuation">:</span> <span class="token punctuation">[</span>
            <span class="token function">Container</span><span class="token punctuation">(</span>
              color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>redAccent<span class="token punctuation">,</span>
              child<span class="token punctuation">:</span> <span class="token function">Center</span><span class="token punctuation">(</span>
                child<span class="token punctuation">:</span> <span class="token function">Text</span><span class="token punctuation">(</span>
                  _topBarTitles<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
                  style<span class="token punctuation">:</span> <span class="token function">TextStyle</span><span class="token punctuation">(</span>color<span class="token punctuation">:</span> Colors<span class="token punctuation">.</span>white<span class="token punctuation">)</span><span class="token punctuation">,</span>
                <span class="token punctuation">)</span><span class="token punctuation">,</span>
              <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token punctuation">)</span><span class="token punctuation">,</span>
            <span class="token function">TabRecommendPage</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
          <span class="token punctuation">]</span><span class="token punctuation">,</span>
        <span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">void</span> <span class="token function">_handleTabController</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">final</span> int index <span class="token operator">=</span> _tabController<span class="token punctuation">.</span>index<span class="token punctuation">;</span>

    <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      _currentIndex <span class="token operator">=</span> index<span class="token punctuation">;</span>
      _topBarTitle <span class="token operator">=</span> _topBarTitles<span class="token punctuation">[</span>index<span class="token punctuation">]</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>我们预览一下当前的效果。</p>
<a href="http://q8ffj20b0.bkt.clouddn.com/blog/2020-04-07-163853.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption="IMG_1B941DC83DD8-1" class="fancybox"><img alt="IMG_1B941DC83DD8-1" style="zoom: 25%;" title="IMG_1B941DC83DD8-1" data-src="http://q8ffj20b0.bkt.clouddn.com/blog/2020-04-07-163853.jpg" class="lazyload"></a>

<p>提交一下代码：</p>
<pre class=" language-shell"><code class="language-shell">git commit -m '使用dio加载网络数据'</code></pre>
<h3 id="Json序列化-反序列化"><a href="#Json序列化-反序列化" class="headerlink" title="Json序列化/反序列化"></a>Json序列化/反序列化</h3><p>接口数据除了RecommendModel封装的几个简单属性之外，还有很多需要要用到的字段，如果一个个手写出来，显然太累了，这时我们就要借助一下工具来处理一下了，接下来我们就用built_value对数据进行序列化。</p>
<p>参考链接 <a href="https://www.stacksecrets.com/flutter/how-to-use-built_value-library" target="_blank" rel="noopener">Sample</a> <a href="https://www.stacksecrets.com/flutter/introduction-to-built_value-library-in-dart" target="_blank" rel="noopener">Introduction</a></p>
<p>首先需要在文件<code>pubspec.yaml</code>中添加built_value依赖，以及两个辅助工具的依赖<code>build_runner</code>和<code>built_value_generator</code>，运行<code>flutter pub. get</code>进行安装。</p>
<pre class=" language-yaml"><code class="language-yaml"><span class="token key atrule">dependencies</span><span class="token punctuation">:</span>
  <span class="token key atrule">flutter</span><span class="token punctuation">:</span>
    <span class="token key atrule">sdk</span><span class="token punctuation">:</span> flutter
  <span class="token comment" spellcheck="true"># iOS风格图标</span>
  <span class="token key atrule">cupertino_icons</span><span class="token punctuation">:</span> ^0.1.2

  <span class="token comment" spellcheck="true"># 多语言库，时间格式化工具</span>
  <span class="token key atrule">intl</span><span class="token punctuation">:</span> ^0.16.1
  <span class="token comment" spellcheck="true"># 网络库</span>
  <span class="token key atrule">dio</span><span class="token punctuation">:</span> ^3.0.9
  <span class="token comment" spellcheck="true"># JSON序列化/反序列化</span>
  <span class="token key atrule">built_value</span><span class="token punctuation">:</span> ^7.0.9

<span class="token key atrule">dev_dependencies</span><span class="token punctuation">:</span>
  <span class="token key atrule">flutter_test</span><span class="token punctuation">:</span>
    <span class="token key atrule">sdk</span><span class="token punctuation">:</span> flutter

  <span class="token comment" spellcheck="true"># JSON序列化/反序列化 辅助工具</span>
  <span class="token key atrule">build_runner</span><span class="token punctuation">:</span> ^1.8.1
  <span class="token key atrule">built_value_generator</span><span class="token punctuation">:</span> ^7.0.9</code></pre>
<p>然后让RecommendModel实现Built抽象类，具体代码如下</p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:built_value/built_value.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">part</span> <span class="token string">'recommend_model.g.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">RecommendModel</span>
    <span class="token keyword">implements</span> <span class="token class-name">Built</span><span class="token operator">&lt;</span>RecommendModel<span class="token punctuation">,</span> RecommendModelBuilder<span class="token operator">></span> <span class="token punctuation">{</span>
  RecommendModel<span class="token punctuation">.</span><span class="token function">_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">factory</span> <span class="token function">RecommendModel</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">updates</span><span class="token punctuation">(</span>RecommendModelBuilder b<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span> _$RecommendModel<span class="token punctuation">;</span>

  String <span class="token keyword">get</span> id<span class="token punctuation">;</span>
  String <span class="token keyword">get</span> title<span class="token punctuation">;</span>
  String <span class="token keyword">get</span> avatarUrl<span class="token punctuation">;</span>
  String <span class="token keyword">get</span> userName<span class="token punctuation">;</span>
  String <span class="token keyword">get</span> imgUrl<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>然后在Terminal中运行一下命令，就会自动生成一个<code>recommend_model.g.dart</code>文件。</p>
<pre class=" language-shell"><code class="language-shell">flutter packages pub run build_runner build</code></pre>
<p>g.dart包含了模型所有属性的getter、setter和构造方法，因为是自动生成的，所以我们可以把g.dart文件加到.gitignore文件中，不需要提交git。</p>
<pre class=" language-yaml"><code class="language-yaml"><span class="token comment" spellcheck="true"># built_value</span>
*.g.dart</code></pre>
<p>接着我们继续把接口的数据结构也封装成模型，这里可以借助这个<a href="https://charafau.github.io/json2builtvalue/" target="_blank" rel="noopener">json转dart</a>代码的网站，把接口返回的json字符串转换成dart代码，然后分拆到model目录下的各个model中。下面是我处理后的结果</p>
<p>lava_result.dart</p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'dart:convert'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">'package:built_collection/built_collection.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:built_value/built_value.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:built_value/serializer.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:evo/recommend_page/model/lava_program.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:evo/recommend_page/model/lava_serializers.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">part</span> <span class="token string">'lava_result.g.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">LavaResult</span> <span class="token keyword">implements</span> <span class="token class-name">Built</span><span class="token operator">&lt;</span>LavaResult<span class="token punctuation">,</span> LavaResultBuilder<span class="token operator">></span> <span class="token punctuation">{</span>
  LavaResult<span class="token punctuation">.</span><span class="token function">_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">factory</span> <span class="token function">LavaResult</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">updates</span><span class="token punctuation">(</span>LavaResultBuilder b<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span> _$LavaResult<span class="token punctuation">;</span>

  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'err'</span><span class="token punctuation">)</span>
  String <span class="token keyword">get</span> err<span class="token punctuation">;</span>
  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'data'</span><span class="token punctuation">)</span>
  LavaData <span class="token keyword">get</span> data<span class="token punctuation">;</span>

  String <span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> json<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span><span class="token function">serializeWith</span><span class="token punctuation">(</span>LavaResult<span class="token punctuation">.</span>serializer<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> LavaResult <span class="token function">fromJson</span><span class="token punctuation">(</span>String jsonString<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> serializers<span class="token punctuation">.</span><span class="token function">deserializeWith</span><span class="token punctuation">(</span>
        LavaResult<span class="token punctuation">.</span>serializer<span class="token punctuation">,</span> <span class="token function">jsonDecode</span><span class="token punctuation">(</span>jsonString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> LavaResult <span class="token function">fromMap</span><span class="token punctuation">(</span>Map map<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> serializers<span class="token punctuation">.</span><span class="token function">deserializeWith</span><span class="token punctuation">(</span>LavaResult<span class="token punctuation">.</span>serializer<span class="token punctuation">,</span> map<span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> Serializer<span class="token operator">&lt;</span>LavaResult<span class="token operator">></span> <span class="token keyword">get</span> serializer <span class="token operator">=</span><span class="token operator">></span> _$lavaResultSerializer<span class="token punctuation">;</span>
<span class="token punctuation">}</span>

<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">LavaData</span> <span class="token keyword">implements</span> <span class="token class-name">Built</span><span class="token operator">&lt;</span>LavaData<span class="token punctuation">,</span> LavaDataBuilder<span class="token operator">></span> <span class="token punctuation">{</span>
  LavaData<span class="token punctuation">.</span><span class="token function">_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">factory</span> <span class="token function">LavaData</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">updates</span><span class="token punctuation">(</span>LavaDataBuilder b<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span> _$LavaData<span class="token punctuation">;</span>

  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'size'</span><span class="token punctuation">)</span>
  String <span class="token keyword">get</span> size<span class="token punctuation">;</span>
  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'total'</span><span class="token punctuation">)</span>
  int <span class="token keyword">get</span> total<span class="token punctuation">;</span>
  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'lists'</span><span class="token punctuation">)</span>
  BuiltList<span class="token operator">&lt;</span>LavaProgram<span class="token operator">></span> <span class="token keyword">get</span> lists<span class="token punctuation">;</span>

  String <span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> json<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span><span class="token function">serializeWith</span><span class="token punctuation">(</span>LavaData<span class="token punctuation">.</span>serializer<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> LavaData <span class="token function">fromJson</span><span class="token punctuation">(</span>String jsonString<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> serializers<span class="token punctuation">.</span><span class="token function">deserializeWith</span><span class="token punctuation">(</span>
        LavaData<span class="token punctuation">.</span>serializer<span class="token punctuation">,</span> json<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>jsonString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> Serializer<span class="token operator">&lt;</span>LavaData<span class="token operator">></span> <span class="token keyword">get</span> serializer <span class="token operator">=</span><span class="token operator">></span> _$lavaDataSerializer<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>lava_program.dart</p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'dart:convert'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">'package:built_collection/built_collection.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:built_value/built_value.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:built_value/serializer.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:evo/recommend_page/model/lava_channel.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:evo/recommend_page/model/lava_user.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:evo/recommend_page/model/lava_serializers.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">part</span> <span class="token string">'lava_program.g.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">LavaProgram</span> <span class="token keyword">implements</span> <span class="token class-name">Built</span><span class="token operator">&lt;</span>LavaProgram<span class="token punctuation">,</span> LavaProgramBuilder<span class="token operator">></span> <span class="token punctuation">{</span>
  LavaProgram<span class="token punctuation">.</span><span class="token function">_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">factory</span> <span class="token function">LavaProgram</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">updates</span><span class="token punctuation">(</span>LavaProgramBuilder b<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span> _$LavaProgram<span class="token punctuation">;</span>

  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'program_id'</span><span class="token punctuation">)</span>
  String <span class="token keyword">get</span> programId<span class="token punctuation">;</span>
  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'program_name'</span><span class="token punctuation">)</span>
  String <span class="token keyword">get</span> programName<span class="token punctuation">;</span>
  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'program_desc'</span><span class="token punctuation">)</span>
  String <span class="token keyword">get</span> programDesc<span class="token punctuation">;</span>
  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'uid'</span><span class="token punctuation">)</span>
  String <span class="token keyword">get</span> uid<span class="token punctuation">;</span>
  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'create_time'</span><span class="token punctuation">)</span>
  String <span class="token keyword">get</span> createTime<span class="token punctuation">;</span>
  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'modify_time'</span><span class="token punctuation">)</span>
  String <span class="token keyword">get</span> modifyTime<span class="token punctuation">;</span>
  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'song_num'</span><span class="token punctuation">)</span>
  String <span class="token keyword">get</span> songNum<span class="token punctuation">;</span>
  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'status'</span><span class="token punctuation">)</span>
  String <span class="token keyword">get</span> status<span class="token punctuation">;</span>
  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'duration'</span><span class="token punctuation">)</span>
  String <span class="token keyword">get</span> duration<span class="token punctuation">;</span>
  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'key'</span><span class="token punctuation">)</span>
  String <span class="token keyword">get</span> key<span class="token punctuation">;</span>
  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'channels'</span><span class="token punctuation">)</span>
  BuiltList<span class="token operator">&lt;</span>LavaChannel<span class="token operator">></span> <span class="token keyword">get</span> channels<span class="token punctuation">;</span>
  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'user'</span><span class="token punctuation">)</span>
  LavaUser <span class="token keyword">get</span> user<span class="token punctuation">;</span>
  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'pic_url'</span><span class="token punctuation">)</span>
  String <span class="token keyword">get</span> picUrl<span class="token punctuation">;</span>

  String <span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> json<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span><span class="token function">serializeWith</span><span class="token punctuation">(</span>LavaProgram<span class="token punctuation">.</span>serializer<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> LavaProgram <span class="token function">fromJson</span><span class="token punctuation">(</span>String jsonString<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> serializers<span class="token punctuation">.</span><span class="token function">deserializeWith</span><span class="token punctuation">(</span>
        LavaProgram<span class="token punctuation">.</span>serializer<span class="token punctuation">,</span> json<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>jsonString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> Serializer<span class="token operator">&lt;</span>LavaProgram<span class="token operator">></span> <span class="token keyword">get</span> serializer <span class="token operator">=</span><span class="token operator">></span> _$lavaProgramSerializer<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>lava_channel.dart</p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'dart:convert'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">'package:built_value/built_value.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:built_value/serializer.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:evo/recommend_page/model/lava_serializers.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">part</span> <span class="token string">'lava_channel.g.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">LavaChannel</span> <span class="token keyword">implements</span> <span class="token class-name">Built</span><span class="token operator">&lt;</span>LavaChannel<span class="token punctuation">,</span> LavaChannelBuilder<span class="token operator">></span> <span class="token punctuation">{</span>
  LavaChannel<span class="token punctuation">.</span><span class="token function">_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">factory</span> <span class="token function">LavaChannel</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">updates</span><span class="token punctuation">(</span>LavaChannelBuilder b<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span> _$LavaChannel<span class="token punctuation">;</span>

  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'recommend'</span><span class="token punctuation">)</span>
  String <span class="token keyword">get</span> recommend<span class="token punctuation">;</span>
  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'channel_id'</span><span class="token punctuation">)</span>
  String <span class="token keyword">get</span> channelId<span class="token punctuation">;</span>
  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'radio_id'</span><span class="token punctuation">)</span>
  String <span class="token keyword">get</span> radioId<span class="token punctuation">;</span>
  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'channel_name'</span><span class="token punctuation">)</span>
  String <span class="token keyword">get</span> channelName<span class="token punctuation">;</span>
  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'english_name'</span><span class="token punctuation">)</span>
  String <span class="token keyword">get</span> englishName<span class="token punctuation">;</span>
  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'channel_desc'</span><span class="token punctuation">)</span>
  String <span class="token keyword">get</span> channelDesc<span class="token punctuation">;</span>
  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'rank'</span><span class="token punctuation">)</span>
  String <span class="token keyword">get</span> rank<span class="token punctuation">;</span>
  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'color'</span><span class="token punctuation">)</span>
  String <span class="token keyword">get</span> color<span class="token punctuation">;</span>
  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'pic_url'</span><span class="token punctuation">)</span>
  String <span class="token keyword">get</span> picUrl<span class="token punctuation">;</span>
  String <span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> json<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span><span class="token function">serializeWith</span><span class="token punctuation">(</span>LavaChannel<span class="token punctuation">.</span>serializer<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> LavaChannel <span class="token function">fromJson</span><span class="token punctuation">(</span>String jsonString<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> serializers<span class="token punctuation">.</span><span class="token function">deserializeWith</span><span class="token punctuation">(</span>
        LavaChannel<span class="token punctuation">.</span>serializer<span class="token punctuation">,</span> json<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>jsonString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> Serializer<span class="token operator">&lt;</span>LavaChannel<span class="token operator">></span> <span class="token keyword">get</span> serializer <span class="token operator">=</span><span class="token operator">></span> _$lavaChannelSerializer<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>lava_user.dart</p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'dart:convert'</span><span class="token punctuation">;</span>

<span class="token keyword">import</span> <span class="token string">'package:built_value/built_value.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:built_value/serializer.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:evo/recommend_page/model/lava_serializers.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">part</span> <span class="token string">'lava_user.g.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">abstract</span> <span class="token keyword">class</span> <span class="token class-name">LavaUser</span> <span class="token keyword">implements</span> <span class="token class-name">Built</span><span class="token operator">&lt;</span>LavaUser<span class="token punctuation">,</span> LavaUserBuilder<span class="token operator">></span> <span class="token punctuation">{</span>
  LavaUser<span class="token punctuation">.</span><span class="token function">_</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

  <span class="token keyword">factory</span> <span class="token function">LavaUser</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token function">updates</span><span class="token punctuation">(</span>LavaUserBuilder b<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token operator">=</span> _$LavaUser<span class="token punctuation">;</span>

  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'uid'</span><span class="token punctuation">)</span>
  String <span class="token keyword">get</span> uid<span class="token punctuation">;</span>
  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'uname'</span><span class="token punctuation">)</span>
  String <span class="token keyword">get</span> uname<span class="token punctuation">;</span>
  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'user_type'</span><span class="token punctuation">)</span>
  String <span class="token keyword">get</span> userType<span class="token punctuation">;</span>
  <span class="token metadata symbol">@BuiltValueField</span><span class="token punctuation">(</span>wireName<span class="token punctuation">:</span> <span class="token string">'pic_url'</span><span class="token punctuation">)</span>
  String <span class="token keyword">get</span> picUrl<span class="token punctuation">;</span>
  String <span class="token function">toJson</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> json<span class="token punctuation">.</span><span class="token function">encode</span><span class="token punctuation">(</span>serializers<span class="token punctuation">.</span><span class="token function">serializeWith</span><span class="token punctuation">(</span>LavaUser<span class="token punctuation">.</span>serializer<span class="token punctuation">,</span> <span class="token keyword">this</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> LavaUser <span class="token function">fromJson</span><span class="token punctuation">(</span>String jsonString<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> serializers<span class="token punctuation">.</span><span class="token function">deserializeWith</span><span class="token punctuation">(</span>
        LavaUser<span class="token punctuation">.</span>serializer<span class="token punctuation">,</span> json<span class="token punctuation">.</span><span class="token function">decode</span><span class="token punctuation">(</span>jsonString<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">static</span> Serializer<span class="token operator">&lt;</span>LavaUser<span class="token operator">></span> <span class="token keyword">get</span> serializer <span class="token operator">=</span><span class="token operator">></span> _$lavaUserSerializer<span class="token punctuation">;</span>
<span class="token punctuation">}</span></code></pre>
<p>除了上述model之外，我们还需要一个总的Serializers来处理序列化和反序列化的程序，代码如下</p>
<p>lava_serializers.dart</p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:built_collection/built_collection.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:built_value/serializer.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:built_value/standard_json_plugin.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:evo/recommend_page/model/lava_channel.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:evo/recommend_page/model/lava_program.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:evo/recommend_page/model/lava_result.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:evo/recommend_page/model/lava_user.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">part</span> <span class="token string">'lava_serializers.g.dart'</span><span class="token punctuation">;</span>

<span class="token metadata symbol">@SerializersFor</span><span class="token punctuation">(</span>
  <span class="token punctuation">[</span>
    LavaResult<span class="token punctuation">,</span>
    LavaProgram<span class="token punctuation">,</span>
    LavaChannel<span class="token punctuation">,</span>
    LavaUser<span class="token punctuation">,</span>
  <span class="token punctuation">]</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>

<span class="token keyword">final</span> Serializers serializers <span class="token operator">=</span>
    <span class="token punctuation">(</span>_$serializers<span class="token punctuation">.</span><span class="token function">toBuilder</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token punctuation">.</span><span class="token function">addPlugin</span><span class="token punctuation">(</span><span class="token function">StandardJsonPlugin</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">build</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span></code></pre>
<p>model创建完成之后，再次运行built_value的生成命令，就可以得到所有model对应的g.dart文件了。</p>
<a href="http://q8ffj20b0.bkt.clouddn.com/blog/2020-04-07-163924.jpg" target="_blank" rel="noopener" data-fancybox="group" data-caption="FF5EBDD2-B648-43D4-A5A4-3D16CF08EA3B" class="fancybox"><img alt="FF5EBDD2-B648-43D4-A5A4-3D16CF08EA3B" style="zoom:50%;" title="FF5EBDD2-B648-43D4-A5A4-3D16CF08EA3B" data-src="http://q8ffj20b0.bkt.clouddn.com/blog/2020-04-07-163924.jpg" class="lazyload"></a>

<p>最后我们改造一下接口响应数据的加载方式，就可以轻松获取到所有的接口数据了。</p>
<p>代码如下</p>
<pre class=" language-dart"><code class="language-dart">  <span class="token keyword">void</span> <span class="token function">loadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    Dio dio <span class="token operator">=</span> <span class="token function">Dio</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Response response <span class="token operator">=</span> <span class="token keyword">await</span> dio<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>
      <span class="token string">'http://www.lavaradio.com/api/radio.listGroundPrograms.json?_pn=3&amp;_sz=20'</span><span class="token punctuation">,</span>
      options<span class="token punctuation">:</span> <span class="token function">Options</span><span class="token punctuation">(</span>responseType<span class="token punctuation">:</span> ResponseType<span class="token punctuation">.</span>plain<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    LavaResult result <span class="token operator">=</span> LavaResult<span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>err <span class="token operator">==</span> <span class="token string">'hapn.ok'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'Request success'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      LavaData resultData <span class="token operator">=</span> result<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>resultData <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">print</span><span class="token punctuation">(</span>
            <span class="token string">'Request result data size:${resultData.size}, total:${resultData.total}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        BuiltList<span class="token operator">&lt;</span>LavaProgram<span class="token operator">></span> dataList <span class="token operator">=</span> resultData<span class="token punctuation">.</span>lists<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>dataList <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> dataList<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          List<span class="token operator">&lt;</span>RecommendModel<span class="token operator">></span> newModels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
          <span class="token keyword">for</span> <span class="token punctuation">(</span>LavaProgram p <span class="token keyword">in</span> dataList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            RecommendModel model <span class="token operator">=</span> <span class="token function">RecommendModel</span><span class="token punctuation">(</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> builder
              <span class="token punctuation">.</span><span class="token punctuation">.</span>id <span class="token operator">=</span> p<span class="token punctuation">.</span>programId
              <span class="token punctuation">.</span><span class="token punctuation">.</span>title <span class="token operator">=</span> p<span class="token punctuation">.</span>programName
              <span class="token punctuation">.</span><span class="token punctuation">.</span>imgUrl <span class="token operator">=</span> p<span class="token punctuation">.</span>picUrl
              <span class="token punctuation">.</span><span class="token punctuation">.</span>userName <span class="token operator">=</span> p<span class="token punctuation">.</span>user<span class="token punctuation">.</span>uname
              <span class="token punctuation">.</span><span class="token punctuation">.</span>avatarUrl <span class="token operator">=</span> p<span class="token punctuation">.</span>user<span class="token punctuation">.</span>picUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
            newModels<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span>

          dataSourceItems<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
            dataSourceItems<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>newModels<span class="token punctuation">)</span><span class="token punctuation">;</span>
          <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>代码解释</p>
<ol>
<li>dio响应使用plain模式，返回json字符串</li>
<li>使用<code>LavaResult.fromJson</code>直接把字符串转换成模型</li>
<li>为了隔离Lava接口对UI的侵入，将LavaProgram转成RecommendModel再使用</li>
</ol>
<p>好像网络请求放在ui里有点不妥，我们把网络请求封装一下吧。</p>
<p>在lib目录下新建net目录，然后再新建一个lava_api.dart文件，把接口请求放到这里来。代码如下</p>
<pre class=" language-dart"><code class="language-dart"><span class="token keyword">import</span> <span class="token string">'package:dio/dio.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:evo/recommend_page/model/lava_program.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:evo/recommend_page/model/lava_result.dart'</span><span class="token punctuation">;</span>
<span class="token keyword">import</span> <span class="token string">'package:built_collection/built_collection.dart'</span><span class="token punctuation">;</span>

<span class="token keyword">class</span> <span class="token class-name">Lava</span> <span class="token punctuation">{</span>
  <span class="token keyword">static</span> Future<span class="token operator">&lt;</span>BuiltList<span class="token operator">&lt;</span>LavaProgram<span class="token operator">>></span> <span class="token function">fetchRecommendPrograms</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    Dio dio <span class="token operator">=</span> <span class="token function">Dio</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    Response response <span class="token operator">=</span> <span class="token keyword">await</span> dio<span class="token punctuation">.</span><span class="token function">request</span><span class="token punctuation">(</span>
      <span class="token string">'http://www.lavaradio.com/api/radio.listGroundPrograms.json?_pn=3&amp;_sz=20'</span><span class="token punctuation">,</span>
      options<span class="token punctuation">:</span> <span class="token function">Options</span><span class="token punctuation">(</span>responseType<span class="token punctuation">:</span> ResponseType<span class="token punctuation">.</span>plain<span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token function">print</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>
    LavaResult result <span class="token operator">=</span> LavaResult<span class="token punctuation">.</span><span class="token function">fromJson</span><span class="token punctuation">(</span>response<span class="token punctuation">.</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>result<span class="token punctuation">.</span>err <span class="token operator">==</span> <span class="token string">'hapn.ok'</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      <span class="token function">print</span><span class="token punctuation">(</span><span class="token string">'Request success'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      LavaData resultData <span class="token operator">=</span> result<span class="token punctuation">.</span>data<span class="token punctuation">;</span>
      <span class="token keyword">if</span> <span class="token punctuation">(</span>resultData <span class="token operator">!=</span> <span class="token keyword">null</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        <span class="token function">print</span><span class="token punctuation">(</span>
            <span class="token string">'Request result data size:${resultData.size}, total:${resultData.total}'</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
        BuiltList<span class="token operator">&lt;</span>LavaProgram<span class="token operator">></span> dataList <span class="token operator">=</span> resultData<span class="token punctuation">.</span>lists<span class="token punctuation">;</span>
        <span class="token keyword">if</span> <span class="token punctuation">(</span>dataList <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> dataList<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
          <span class="token keyword">return</span> dataList<span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>

    <span class="token keyword">return</span> <span class="token keyword">null</span><span class="token punctuation">;</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span></code></pre>
<p>tab_recommend_page.dart</p>
<pre class=" language-dart"><code class="language-dart">  <span class="token keyword">void</span> <span class="token function">loadData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">async</span> <span class="token punctuation">{</span>
    BuiltList<span class="token operator">&lt;</span>LavaProgram<span class="token operator">></span> dataList <span class="token operator">=</span> <span class="token keyword">await</span> Lava<span class="token punctuation">.</span><span class="token function">fetchRecommendPrograms</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>

    <span class="token keyword">if</span> <span class="token punctuation">(</span>dataList <span class="token operator">!=</span> <span class="token keyword">null</span> <span class="token operator">&amp;&amp;</span> dataList<span class="token punctuation">.</span>length <span class="token operator">></span> <span class="token number">0</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
      List<span class="token operator">&lt;</span>RecommendModel<span class="token operator">></span> newModels <span class="token operator">=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token punctuation">;</span>
      <span class="token keyword">for</span> <span class="token punctuation">(</span>LavaProgram p <span class="token keyword">in</span> dataList<span class="token punctuation">)</span> <span class="token punctuation">{</span>
        RecommendModel model <span class="token operator">=</span> <span class="token function">RecommendModel</span><span class="token punctuation">(</span><span class="token punctuation">(</span>builder<span class="token punctuation">)</span> <span class="token operator">=</span><span class="token operator">></span> builder
          <span class="token punctuation">.</span><span class="token punctuation">.</span>id <span class="token operator">=</span> p<span class="token punctuation">.</span>programId
          <span class="token punctuation">.</span><span class="token punctuation">.</span>title <span class="token operator">=</span> p<span class="token punctuation">.</span>programName
          <span class="token punctuation">.</span><span class="token punctuation">.</span>imgUrl <span class="token operator">=</span> p<span class="token punctuation">.</span>picUrl
          <span class="token punctuation">.</span><span class="token punctuation">.</span>userName <span class="token operator">=</span> p<span class="token punctuation">.</span>user<span class="token punctuation">.</span>uname
          <span class="token punctuation">.</span><span class="token punctuation">.</span>avatarUrl <span class="token operator">=</span> p<span class="token punctuation">.</span>user<span class="token punctuation">.</span>picUrl<span class="token punctuation">)</span><span class="token punctuation">;</span>
        newModels<span class="token punctuation">.</span><span class="token function">add</span><span class="token punctuation">(</span>model<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span>

      dataSourceItems<span class="token punctuation">.</span><span class="token function">clear</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token function">setState</span><span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
        dataSourceItems<span class="token punctuation">.</span><span class="token function">addAll</span><span class="token punctuation">(</span>newModels<span class="token punctuation">)</span><span class="token punctuation">;</span>
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span></code></pre>
<p>到此，我们就完成网络数据的加载了！git记录一下。</p>
<pre class=" language-shell"><code class="language-shell">git commit -m '使用built_value处理json数据'</code></pre>
</div></article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">Author: </span><span class="post-copyright-info"><a href="mailto:undefined">若鱼</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">Link: </span><span class="post-copyright-info"><a href="http://songjiaqiang.com/2020/04/08/flutter-project-evo-01/">http://songjiaqiang.com/2020/04/08/flutter-project-evo-01/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">Copyright Notice: </span><span class="post-copyright-info">All articles in this blog are licensed under <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank" rel="noopener">CC BY-NC-SA 4.0</a> unless stating additionally.</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/flutter/">flutter    </a><a class="post-meta__tags" href="/tags/evo/">evo    </a></div><div class="post_share"><div class="social-share" data-image="https://tva1.sinaimg.cn/large/00831rSTgy1gdlout454uj30v90istak.jpg" data-sites="facebook,twitter,wechat,weibo,qq"></div><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/social-share.js/dist/css/share.min.css"><script src="https://cdn.jsdelivr.net/npm/social-share.js/dist/js/social-share.min.js"></script></div></div><nav class="pagination_post" id="pagination"><div class="next-post pull-full"><a href="/2020/02/05/007-learning-flutter-3-base-widget/"><img class="next_cover lazyload" data-src="https://tva1.sinaimg.cn/large/006tNbRwgy1gbjk29ezokj30yo0euaak.jpg" onerror="onerror=null;src='/img/404.jpg'"><div class="label">Next Post</div><div class="next_info"><span>Flutter学习笔记3 - 基础控件</span></div></a></div></nav><div class="relatedPosts"><div class="relatedPosts_headline"><i class="fa fa-fw fa-thumbs-up" aria-hidden="true"></i><span> Recommend</span></div><div class="relatedPosts_list"><div class="relatedPosts_item"><a href="/2020/02/03/005-learning-flutter-1-install/" title="Flutter学习笔记1 - 安装Flutter"><img class="relatedPosts_cover lazyload"data-src="https://tva1.sinaimg.cn/large/006tNbRwgy1gbjk29ezokj30yo0euaak.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-02-03</div><div class="relatedPosts_title">Flutter学习笔记1 - 安装Flutter</div></div></a></div><div class="relatedPosts_item"><a href="/2020/02/04/006-learning-flutter-2-first-app/" title="Flutter学习笔记2 - 第一个App"><img class="relatedPosts_cover lazyload"data-src="https://tva1.sinaimg.cn/large/006tNbRwgy1gbjk29ezokj30yo0euaak.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-02-04</div><div class="relatedPosts_title">Flutter学习笔记2 - 第一个App</div></div></a></div><div class="relatedPosts_item"><a href="/2020/02/05/007-learning-flutter-3-base-widget/" title="Flutter学习笔记3 - 基础控件"><img class="relatedPosts_cover lazyload"data-src="https://tva1.sinaimg.cn/large/006tNbRwgy1gbjk29ezokj30yo0euaak.jpg"><div class="relatedPosts_main is-center"><div class="relatedPosts_date"><i class="fa fa-calendar fa-fw" aria-hidden="true"></i> 2020-02-05</div><div class="relatedPosts_title">Flutter学习笔记3 - 基础控件</div></div></a></div></div><div class="clear_both"></div></div><hr><div id="post-comment"><div class="comment_headling"><i class="fa fa-comments fa-fw" aria-hidden="true"></i><span> Comment</span></div><div id="gitalk-container"></div><script>var gitalk = new Gitalk({
  clientID: '2d469d2a894a73c62e0a',
  clientSecret: 'd72cf82d70e5c92abd75db227f658768f6f9795b',
  repo: 'songjiaqiang.github.io',
  owner: 'SongJiaqiang',
  admin: 'SongJiaqiang',
  id: md5(decodeURI(location.pathname)),
  language: 'en',
  updateCountCallback: commentCount
})
gitalk.render('gitalk-container')

function commentCount(n){
  document.getElementsByClassName('gitalk-comment-count')[0].innerHTML= n
}</script></div></div></main><footer id="footer" data-type="color"><div id="footer-wrap"><div class="copyright">&copy;2020 By 若鱼</div><div class="framework-info"><span>Driven </span><a href="http://hexo.io" target="_blank" rel="noopener"><span>Hexo</span></a><span class="footer-separator">|</span><span>Theme </span><a href="https://github.com/jerryc127/hexo-theme-butterfly" target="_blank" rel="noopener"><span>Butterfly</span></a></div></div></footer></div><section class="rightside" id="rightside"><div id="rightside-config-hide"><i class="fa fa-book" id="readmode" title="Read Mode"></i><i class="fa fa-plus" id="font_plus" title="Increase font size"></i><i class="fa fa-minus" id="font_minus" title="Decrease font size"></i><a class="translate_chn_to_cht" id="translateLink" href="javascript:translatePage();" title="Traditional Chinese and Simplified Chinese Conversion" target="_self">繁</a><i class="darkmode fa fa-moon-o" id="darkmode" title="Dark Mode"></i></div><div id="rightside-config-show"><div id="rightside_config" title="Setting"><i class="fa fa-cog" aria-hidden="true"></i></div><a id="to_comment" href="#post-comment" title="Scroll to comment"><i class="scroll_to_comment fa fa-comments">  </i></a><i class="fa fa-list-ul close" id="mobile-toc-button" title="Table of Contents" aria-hidden="true"></i><i class="fa fa-arrow-up" id="go-up" title="Back to top" aria-hidden="true"></i></div></section><script src="https://cdn.jsdelivr.net/npm/jquery@latest/dist/jquery.min.js"></script><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/fancybox@latest/dist/jquery.fancybox.min.js"></script><script async src="//busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script><script src="https://cdn.jsdelivr.net/npm/instant.page@latest/instantpage.min.js" type="module"></script><script src="https://cdn.jsdelivr.net/npm/lazysizes@latest/lazysizes.min.js" async=""></script></body></html>